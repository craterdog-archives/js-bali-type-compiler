[
    $procedure: {
        checkout $draft from /acme/documents/example/v1.2
        save draft
        commit draft to /acme/documents/example/v1.3
        checkout level 3 of drafts[index] from /acme/documents/example/v1.3
        save drafts[index] as citations[index]
        commit drafts[index] to /acme/documents/example/v1.3.1
        discard drafts[index]
    }
    $instructions: "
        1.CheckoutStatement:
        ---- Save the name of the document.
        PUSH LITERAL `/acme/documents/example/v1.2`
        SAVE VARIABLE $name-2
        ---- Load a draft copy of the named document from the repository.
        LOAD DOCUMENT $name-2
        CALL $duplicate WITH 1 ARGUMENT
        SAVE VARIABLE $draft-3
        ---- Calculate the new version string for the draft and save it.
        LOAD VARIABLE $draft-3
        PUSH LITERAL `$version`
        CALL $parameter WITH 2 ARGUMENTS
        PUSH LITERAL `0`
        CALL $nextVersion WITH 2 ARGUMENTS
        SAVE VARIABLE $version-4
        ---- Set the new version string parameter for the draft document.
        LOAD VARIABLE $draft-3
        PUSH LITERAL `$version`
        LOAD VARIABLE $version-4
        CALL $setParameter WITH 3 ARGUMENTS
        PULL COMPONENT
        ---- Set the new draft document as the value of the recipient.
        LOAD VARIABLE $draft-3
        SAVE VARIABLE $draft
        
        2.SaveStatement:
        ---- Save the draft document.
        LOAD VARIABLE $draft
        SAVE VARIABLE $draft-5
        ---- Save the draft document and a citation to it.
        LOAD VARIABLE $draft-5
        SAVE VARIABLE $citation-6
        ---- Save the cited draft document to the repository.
        LOAD VARIABLE $draft-5
        SAVE DRAFT $citation-6
        
        3.CommitStatement:
        ---- Save the name of the document.
        PUSH LITERAL `/acme/documents/example/v1.3`
        SAVE VARIABLE $name-7
        ---- Commit the named document to the repository.
        LOAD VARIABLE $draft
        SAVE DOCUMENT $name-7
        
        4.CheckoutStatement:
        ---- Save the name of the document.
        PUSH LITERAL `/acme/documents/example/v1.3`
        SAVE VARIABLE $name-8
        ---- Load a draft copy of the named document from the repository.
        LOAD DOCUMENT $name-8
        CALL $duplicate WITH 1 ARGUMENT
        SAVE VARIABLE $draft-9
        ---- Calculate the new version string for the draft and save it.
        LOAD VARIABLE $draft-9
        PUSH LITERAL `$version`
        CALL $parameter WITH 2 ARGUMENTS
        PUSH LITERAL `3`
        CALL $nextVersion WITH 2 ARGUMENTS
        SAVE VARIABLE $version-10
        ---- Set the new version string parameter for the draft document.
        LOAD VARIABLE $draft-9
        PUSH LITERAL `$version`
        LOAD VARIABLE $version-10
        CALL $setParameter WITH 3 ARGUMENTS
        PULL COMPONENT
        ---- Set the new draft document as the value of the recipient.
        ---- Place the recipient and the index of its subcomponent on the stack.
        LOAD VARIABLE $drafts
        LOAD VARIABLE $index
        LOAD VARIABLE $draft-9
        ---- Assign the result as the value of the subcomponent.
        CALL $setSubcomponent WITH 3 ARGUMENTS
        PULL COMPONENT
        
        5.SaveStatement:
        ---- Save the draft document.
        LOAD VARIABLE $drafts
        LOAD VARIABLE $index
        CALL $subcomponent WITH 2 ARGUMENTS
        SAVE VARIABLE $draft-11
        ---- Save the draft document and a citation to it.
        LOAD VARIABLE $draft-11
        SAVE VARIABLE $citation-12
        ---- Save the cited draft document to the repository.
        LOAD VARIABLE $draft-11
        SAVE DRAFT $citation-12
        ---- Place the recipient and the index of its subcomponent on the stack.
        LOAD VARIABLE $citations
        LOAD VARIABLE $index
        LOAD VARIABLE $citation-12
        ---- Assign the result as the value of the subcomponent.
        CALL $setSubcomponent WITH 3 ARGUMENTS
        PULL COMPONENT
        
        6.CommitStatement:
        ---- Save the name of the document.
        PUSH LITERAL `/acme/documents/example/v1.3.1`
        SAVE VARIABLE $name-13
        ---- Commit the named document to the repository.
        LOAD VARIABLE $drafts
        LOAD VARIABLE $index
        CALL $subcomponent WITH 2 ARGUMENTS
        SAVE DOCUMENT $name-13
        
        7.DiscardStatement:
        ---- Save a citation to the draft document.
        LOAD VARIABLE $drafts
        LOAD VARIABLE $index
        CALL $subcomponent WITH 2 ARGUMENTS
        CALL $citation WITH 1 ARGUMENT
        SAVE VARIABLE $citation-14
        ---- Drop the cited draft document from the repository.
        DROP DRAFT $citation-14
        LOAD VARIABLE $result-1
        PULL RESULT
    "($mediaType: "application/basm")
    $addresses: [
        "1.CheckoutStatement": 1
        "2.SaveStatement": 19
        "3.CommitStatement": 25
        "4.CheckoutStatement": 29
        "5.SaveStatement": 50
        "6.CommitStatement": 63
        "7.DiscardStatement": 69
    ]
    $bytecode: '
        2801800D700DC829800760072802D0602803D05B8012600728026012D882
        4800600780056005800860088003600888032805800E6005900E2805800F
        700FC829800960092802D0602808D05B8011600928026011D8824800600A
        600B6009D8834800600A600BD08B800660068001600688016004600B6001
        D8834800280A800C600A600BD08B900C600A600BD08BC8158002A8026010
        5000
    '(
        $encoding: $base16
        $mediaType: "application/bcod"
    )
    $arguments: [
        $target
    ]
    $variables: [
        $citation-12
        $citation-14
        $citation-6
        $citations
        $draft
        $draft-11
        $draft-3
        $draft-5
        $draft-9
        $drafts
        $index
        $name-13
        $name-2
        $name-7
        $name-8
        $result-1
        $version-10
        $version-4
    ]($type: /bali/collections/Set/v1)
    $messages: [ ]($type: /bali/collections/Set/v1)
]
